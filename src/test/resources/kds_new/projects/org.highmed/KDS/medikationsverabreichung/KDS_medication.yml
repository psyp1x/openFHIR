grammar: FHIRConnect/v0.9.0
type: extension
metadata:
  name:  KDS_medication.v2
  version: 0.0.1-alpha 
spec: 
  system: FHIR
  version: R4
  extends: CLUSTER.medication.v2

#todo: example of fhir data please, what should this map to??
mappings:

  - name: "name"
    extension: "overwrite"
    with:
      fhir: "$resource.code.coding.display" # missing coded_text in template
      openehr: "$archetype/items[at0132]"
      
  # KDS override: prevent recursive ingredients mapping that references CLUSTER.medication.v2 again
  - name: "ingredients"
    extension: "overwrite"
    with:
      fhir: "$resource.ingredient"
      openehr: "$archetype/items[openEHR-EHR-CLUSTER.medication.v2]"
      type: "NONE"
    followedBy:
      mappings:
        - name: "ingredient"
          with:
            fhir: "item.as(CodeableConcept)"
            openehr: "$openehrRoot"
            type: "NONE"
          followedBy:
            mappings:
              - name: "itemtext"
                with:
                  fhir: "text"
                  openehr: "items[at0132]"

              - name: "wirkstofftyp"
                with:
                  fhir: "coding"
                  openehr: "items[at0142]"

        - name: "strength"
          with:
            fhir: "strength"
            openehr: "items[at0152]"
            type: "NONE"
          followedBy:
            mappings:
              - name: "numerator"
                with:
                  fhir: "numerator"
                  openehr: "items[at0153]"

              - name: "denominator"
                with:
                  fhir: "denominator"
                  openehr: "items[at0157]"

